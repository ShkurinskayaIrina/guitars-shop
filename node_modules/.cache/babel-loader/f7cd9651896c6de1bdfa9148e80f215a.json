{"ast":null,"code":"import _slicedToArray from\"C:/\\u0418\\u0440\\u0438\\u043D\\u0430/Projects/guitars-shop/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{Link}from'react-router-dom';import{store}from'../../store/index';import{fetchComments}from'../../store/api-actions';import{getGuitarComments}from'../../store/guitars-data/selector';import{useAppSelector}from'../../hooks';import Review from'../review/review';import ReviewModal from'../review-modal/review-modal';import ModalSuccess from'../modal-success/modal-success';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var COMMENTS_COUNT_PER_STEP=3;function ReviewsList(_ref){var guitarId=_ref.guitarId,guitarName=_ref.guitarName;var _useState=useState(COMMENTS_COUNT_PER_STEP),_useState2=_slicedToArray(_useState,2),commentsCount=_useState2[0],setCommentsCount=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isReviewModalOpened=_useState4[0],setIsReviewModalOpened=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isModalSuccessOpened=_useState6[0],setIsModalSuccessOpened=_useState6[1];useEffect(function(){store.dispatch(fetchComments(Number(guitarId)));},[guitarId]);useEffect(function(){document.addEventListener('scroll',scrollHandler);return function(){document.removeEventListener('scroll',scrollHandler);};});var guitarComments=useAppSelector(getGuitarComments);var commentsSorted=guitarComments.slice(0).sort(function(prev,next){return new Date(next.createAt).getTime()-new Date(prev.createAt).getTime();});var commentsForRender=commentsSorted.slice(0,commentsCount);function handleShowMoreButtonClick(){setCommentsCount(Math.min(commentsSorted.length,commentsCount+COMMENTS_COUNT_PER_STEP));}function scrollHandler(){if(document.documentElement.scrollHeight-document.documentElement.scrollTop-window.innerHeight<250&&commentsCount<guitarComments.length){setCommentsCount(Math.min(commentsSorted.length,commentsCount+COMMENTS_COUNT_PER_STEP));}}function onReviewBtnClick(){setIsReviewModalOpened(true);}function onReviewCloseClick(){setIsReviewModalOpened(false);}function openModalSuccessSubmit(){setIsModalSuccessOpened(true);}function closeModalSuccessSubmit(){setIsModalSuccessOpened(false);}function onUpButtonClick(){window.scrollTo({top:0,left:0,behavior:'smooth'});}return/*#__PURE__*/_jsxs(\"section\",{className:\"reviews\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"reviews__title title title--bigger\",children:\"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"}),/*#__PURE__*/_jsx(Link,{className:\"button button--red-border button--big reviews__sumbit-button\",to:\"\",onClick:onReviewBtnClick,children:\"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\"}),commentsForRender.map(function(comment){return/*#__PURE__*/_jsx(Review,{commentForRender:comment},comment.id);}),commentsSorted.length>commentsCount?/*#__PURE__*/_jsx(\"button\",{className:\"button button--medium reviews__more-button\",onClick:function onClick(){return handleShowMoreButtonClick();},children:\"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0435\\u0449\\u0435 \\u043E\\u0442\\u0437\\u044B\\u0432\\u044B\"}):'',/*#__PURE__*/_jsx(Link,{className:\"button button--up button--red-border button--big reviews__up-button\",to:\"\",onClick:onUpButtonClick,children:\"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"}),isReviewModalOpened&&/*#__PURE__*/_jsx(ReviewModal,{idGuitar:guitarId,guitarName:guitarName,onReviewCloseClick:onReviewCloseClick,openModalSuccessSubmit:openModalSuccessSubmit}),isModalSuccessOpened&&/*#__PURE__*/_jsx(ModalSuccess,{closeModalSuccessSubmit:closeModalSuccessSubmit})]});}export default ReviewsList;","map":{"version":3,"names":["useEffect","useState","Link","store","fetchComments","getGuitarComments","useAppSelector","Review","ReviewModal","ModalSuccess","COMMENTS_COUNT_PER_STEP","ReviewsList","guitarId","guitarName","commentsCount","setCommentsCount","isReviewModalOpened","setIsReviewModalOpened","isModalSuccessOpened","setIsModalSuccessOpened","dispatch","Number","document","addEventListener","scrollHandler","removeEventListener","guitarComments","commentsSorted","slice","sort","prev","next","Date","createAt","getTime","commentsForRender","handleShowMoreButtonClick","Math","min","length","documentElement","scrollHeight","scrollTop","window","innerHeight","onReviewBtnClick","onReviewCloseClick","openModalSuccessSubmit","closeModalSuccessSubmit","onUpButtonClick","scrollTo","top","left","behavior","map","comment","id"],"sources":["C:/Ирина/Projects/guitars-shop/src/components/reviews-list/reviews-list.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { store } from '../../store/index';\r\nimport { fetchComments } from '../../store/api-actions';\r\nimport { getGuitarComments } from '../../store/guitars-data/selector';\r\nimport { useAppSelector } from '../../hooks';\r\n\r\nimport Review from '../review/review';\r\nimport ReviewModal from '../review-modal/review-modal';\r\nimport ModalSuccess from '../modal-success/modal-success';\r\n\r\nconst COMMENTS_COUNT_PER_STEP = 3;\r\n\r\ntype Props = {\r\n  guitarId?: string,\r\n  guitarName:string,\r\n}\r\n\r\nfunction ReviewsList({guitarId, guitarName}: Props): JSX.Element {\r\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\r\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\r\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\r\n\r\n  useEffect(() => {\r\n    store.dispatch(fetchComments(Number(guitarId)));\r\n  }, [guitarId]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('scroll', scrollHandler);\r\n    return function () {\r\n      document.removeEventListener('scroll', scrollHandler);\r\n    };\r\n  });\r\n\r\n  const guitarComments = useAppSelector(getGuitarComments);\r\n\r\n  const commentsSorted =  guitarComments.slice(0).sort((prev, next) =>\r\n    new Date(next.createAt).getTime() - new Date(prev.createAt).getTime(),\r\n  );\r\n\r\n  const commentsForRender = commentsSorted.slice(0, commentsCount);\r\n\r\n  function handleShowMoreButtonClick() {\r\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n  }\r\n\r\n  function scrollHandler() {\r\n    if ((document.documentElement.scrollHeight -\r\n      document.documentElement.scrollTop - window.innerHeight)<250 &&\r\n       commentsCount<guitarComments.length) {\r\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n    }\r\n  }\r\n\r\n  function onReviewBtnClick(){\r\n    setIsReviewModalOpened(true);\r\n  }\r\n\r\n  function onReviewCloseClick(){\r\n    setIsReviewModalOpened(false);\r\n  }\r\n\r\n  function openModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(true);\r\n  }\r\n\r\n  function closeModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(false);\r\n  }\r\n\r\n  function onUpButtonClick() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      left: 0,\r\n      behavior: 'smooth',\r\n    });\r\n  }\r\n\r\n  return (\r\n    <section className=\"reviews\">\r\n      <h3 className=\"reviews__title title title--bigger\">Отзывы</h3>\r\n      <Link className=\"button button--red-border button--big reviews__sumbit-button\"\r\n        to=\"\" onClick={onReviewBtnClick}\r\n      >Оставить отзыв\r\n      </Link>\r\n\r\n      {commentsForRender.map((comment) => (\r\n        <Review commentForRender={comment} key={comment.id}/>\r\n      ))}\r\n\r\n      {commentsSorted.length>commentsCount ?\r\n        <button className=\"button button--medium reviews__more-button\"\r\n          onClick={() => handleShowMoreButtonClick()}\r\n        >\r\n        Показать еще отзывы\r\n        </button> :\r\n        ''}\r\n\r\n      <Link className=\"button button--up button--red-border button--big reviews__up-button\" to=\"\" onClick={onUpButtonClick}>Наверх\r\n      </Link>\r\n\r\n      {isReviewModalOpened &&\r\n      <ReviewModal idGuitar={guitarId}\r\n        guitarName={guitarName}\r\n        onReviewCloseClick={onReviewCloseClick}\r\n        openModalSuccessSubmit={openModalSuccessSubmit}\r\n      />}\r\n\r\n      {isModalSuccessOpened &&\r\n      <ModalSuccess closeModalSuccessSubmit={closeModalSuccessSubmit}/>}\r\n    </section>\r\n  );\r\n}\r\n\r\nexport default ReviewsList;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}