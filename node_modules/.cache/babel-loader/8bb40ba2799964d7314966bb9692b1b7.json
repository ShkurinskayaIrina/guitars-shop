{"ast":null,"code":"var _jsxFileName = \"C:\\\\\\u0418\\u0440\\u0438\\u043D\\u0430\\\\Projects\\\\guitars-shop\\\\src\\\\components\\\\reviews-list\\\\reviews-list.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { store } from '../../store/index';\nimport { fetchComments } from '../../store/api-actions';\nimport { useAppSelector } from '../../hooks'; // import { NameSpace } from '../../consts';\n\nimport { getGuitarComments } from '../../store/guitars-data/selector';\nimport Review from '../review/review';\nimport ReviewModal from '../review-modal/review-modal';\nimport ModalSuccess from '../modal-success/modal-success';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst COMMENTS_COUNT_PER_STEP = 3;\n\nfunction ReviewsList(_ref) {\n  _s();\n\n  let {\n    guitarId,\n    guitarName\n  } = _ref;\n  let commentsSorted = [];\n  let commentsForRender = [];\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\n  useEffect(() => {\n    store.dispatch(fetchComments(Number(guitarId)));\n  }, [guitarId]);\n  useEffect(() => {\n    document.addEventListener('scroll', scrollHandler);\n    return function () {\n      document.removeEventListener('scroll', scrollHandler);\n    };\n  }); // const guitarsComments = useAppSelector((state) => state[NameSpace.Data].guitarsComments);\n\n  const allGuitarsReviews = useAppSelector(getGuitarComments);\n  const guitarComments = allGuitarsReviews[Number(guitarId)]; // const guitarComments: Comments = guitarsComments[Number(guitarId)];\n\n  if (guitarComments !== undefined) {\n    commentsSorted = guitarComments.slice(0).sort((prev, next) => new Date(next.createAt).getTime() - new Date(prev.createAt).getTime());\n    commentsForRender = commentsSorted.slice(0, commentsCount);\n  }\n\n  function handleShowMoreButtonClick() {\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n  }\n\n  function scrollHandler() {\n    if (document.documentElement.scrollHeight - document.documentElement.scrollTop - window.innerHeight < 250 && commentsCount < guitarComments.length) {\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n    }\n  }\n\n  function onReviewBtnClick() {\n    setIsReviewModalOpened(true);\n  }\n\n  function onReviewCloseClick() {\n    setIsReviewModalOpened(false);\n  }\n\n  function openModalSuccessSubmit() {\n    setIsModalSuccessOpened(true);\n  }\n\n  function closeModalSuccessSubmit() {\n    setIsModalSuccessOpened(false);\n  }\n\n  function onUpButtonClick() {\n    window.scrollTo({\n      top: 0,\n      left: 0,\n      behavior: 'smooth'\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"reviews\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"reviews__title title title--bigger\",\n      children: \"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      className: \"button button--red-border button--big reviews__sumbit-button\",\n      to: \"\",\n      onClick: onReviewBtnClick,\n      children: \"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), commentsForRender.map(comment => /*#__PURE__*/_jsxDEV(Review, {\n      commentForRender: comment\n    }, comment.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }, this)), commentsSorted.length > commentsCount ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"button button--medium reviews__more-button hidden\",\n      onClick: () => handleShowMoreButtonClick(),\n      children: \"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0435\\u0449\\u0435 \\u043E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 11\n    }, this) : '', commentsSorted.length === 0 ? /*#__PURE__*/_jsxDEV(Link, {\n      to: \"\",\n      className: \"button button--up button--red-border button--big\",\n      style: {\n        bottom: '-61px',\n        right: '0',\n        position: 'absolute'\n      },\n      onClick: onUpButtonClick,\n      children: \"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 11\n    }, this) : /*#__PURE__*/_jsxDEV(Link, {\n      to: \"\",\n      className: \"button button--up button--red-border button--big reviews__up-button\",\n      onClick: onUpButtonClick,\n      children: \"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 11\n    }, this), isReviewModalOpened && /*#__PURE__*/_jsxDEV(ReviewModal, {\n      idGuitar: guitarId,\n      guitarName: guitarName,\n      onReviewCloseClick: onReviewCloseClick,\n      openModalSuccessSubmit: openModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }, this), isModalSuccessOpened && /*#__PURE__*/_jsxDEV(ModalSuccess, {\n      closeModalSuccessSubmit: closeModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ReviewsList, \"VK7GKX2LisHZuBa/5gDXhftgNU4=\", false, function () {\n  return [useAppSelector];\n});\n\n_c = ReviewsList;\nexport default ReviewsList;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReviewsList\");","map":{"version":3,"names":["useEffect","useState","Link","store","fetchComments","useAppSelector","getGuitarComments","Review","ReviewModal","ModalSuccess","COMMENTS_COUNT_PER_STEP","ReviewsList","guitarId","guitarName","commentsSorted","commentsForRender","commentsCount","setCommentsCount","isReviewModalOpened","setIsReviewModalOpened","isModalSuccessOpened","setIsModalSuccessOpened","dispatch","Number","document","addEventListener","scrollHandler","removeEventListener","allGuitarsReviews","guitarComments","undefined","slice","sort","prev","next","Date","createAt","getTime","handleShowMoreButtonClick","Math","min","length","documentElement","scrollHeight","scrollTop","window","innerHeight","onReviewBtnClick","onReviewCloseClick","openModalSuccessSubmit","closeModalSuccessSubmit","onUpButtonClick","scrollTo","top","left","behavior","map","comment","id","bottom","right","position"],"sources":["C:/Ирина/Projects/guitars-shop/src/components/reviews-list/reviews-list.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { store } from '../../store/index';\r\nimport { fetchComments } from '../../store/api-actions';\r\nimport { useAppSelector } from '../../hooks';\r\n// import { NameSpace } from '../../consts';\r\nimport { Comments, GuitarsComments } from '../../types/guitars';\r\nimport { getGuitarComments } from '../../store/guitars-data/selector';\r\nimport Review from '../review/review';\r\nimport ReviewModal from '../review-modal/review-modal';\r\nimport ModalSuccess from '../modal-success/modal-success';\r\n\r\nconst COMMENTS_COUNT_PER_STEP = 3;\r\n\r\ntype Props = {\r\n  guitarId?: string,\r\n  guitarName:string,\r\n}\r\n\r\nfunction ReviewsList({guitarId, guitarName}: Props): JSX.Element {\r\n  let commentsSorted = [] as Comments;\r\n  let commentsForRender = [] as Comments;\r\n\r\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\r\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\r\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\r\n\r\n  useEffect(() => {\r\n    store.dispatch(fetchComments(Number(guitarId)));\r\n  }, [guitarId]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('scroll', scrollHandler);\r\n    return function () {\r\n      document.removeEventListener('scroll', scrollHandler);\r\n    };\r\n  });\r\n\r\n  // const guitarsComments = useAppSelector((state) => state[NameSpace.Data].guitarsComments);\r\n  const allGuitarsReviews: GuitarsComments = useAppSelector(getGuitarComments);\r\n  const guitarComments = allGuitarsReviews[Number(guitarId as string)];\r\n  // const guitarComments: Comments = guitarsComments[Number(guitarId)];\r\n\r\n  if (guitarComments !== undefined) {\r\n    commentsSorted =  guitarComments.slice(0).sort((prev, next) =>\r\n      new Date(next.createAt).getTime() - new Date(prev.createAt).getTime(),\r\n    );\r\n\r\n    commentsForRender = commentsSorted.slice(0, commentsCount);\r\n  }\r\n\r\n  function handleShowMoreButtonClick() {\r\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n  }\r\n\r\n  function scrollHandler() {\r\n    if ((document.documentElement.scrollHeight -\r\n      document.documentElement.scrollTop - window.innerHeight)<250 &&\r\n       commentsCount<guitarComments.length) {\r\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n    }\r\n  }\r\n\r\n  function onReviewBtnClick(){\r\n    setIsReviewModalOpened(true);\r\n  }\r\n\r\n  function onReviewCloseClick(){\r\n    setIsReviewModalOpened(false);\r\n  }\r\n\r\n  function openModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(true);\r\n  }\r\n\r\n  function closeModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(false);\r\n  }\r\n\r\n  function onUpButtonClick() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      left: 0,\r\n      behavior: 'smooth',\r\n    });\r\n  }\r\n\r\n  return (\r\n    <section className=\"reviews\">\r\n      <h3 className=\"reviews__title title title--bigger\">Отзывы</h3>\r\n      <Link className=\"button button--red-border button--big reviews__sumbit-button\"\r\n        to=\"\" onClick={onReviewBtnClick}\r\n      >Оставить отзыв\r\n      </Link>\r\n\r\n      {commentsForRender.map((comment) => (\r\n        <Review commentForRender={comment} key={comment.id}/>\r\n      ))}\r\n\r\n      {\r\n        commentsSorted.length>commentsCount ?\r\n          <button className=\"button button--medium reviews__more-button hidden\"\r\n            onClick={() => handleShowMoreButtonClick()}\r\n          >\r\n        Показать еще отзывы\r\n          </button> :\r\n          ''\r\n      }\r\n\r\n      {\r\n        commentsSorted.length === 0 ?\r\n          <Link to=\"\"\r\n            className=\"button button--up button--red-border button--big\"\r\n            style={{bottom:'-61px', right:'0', position:'absolute'}}\r\n            onClick={onUpButtonClick}\r\n          >\r\n        Наверх\r\n          </Link> :\r\n          <Link to=\"\"\r\n            className=\"button button--up button--red-border button--big reviews__up-button\"\r\n            onClick={onUpButtonClick}\r\n          >\r\n      Наверх\r\n          </Link>\r\n      }\r\n\r\n\r\n      {isReviewModalOpened &&\r\n      <ReviewModal idGuitar={guitarId}\r\n        guitarName={guitarName}\r\n        onReviewCloseClick={onReviewCloseClick}\r\n        openModalSuccessSubmit={openModalSuccessSubmit}\r\n      />}\r\n\r\n      {isModalSuccessOpened &&\r\n      <ModalSuccess closeModalSuccessSubmit={closeModalSuccessSubmit}/>}\r\n    </section>\r\n  );\r\n}\r\n\r\nexport default ReviewsList;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}