{"ast":null,"code":"var _jsxFileName = \"C:\\\\\\u0418\\u0440\\u0438\\u043D\\u0430\\\\Projects\\\\guitars-shop\\\\src\\\\components\\\\reviews-list\\\\reviews-list.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { store } from '../../store/index';\nimport { fetchComments } from '../../store/api-actions';\nimport { getGuitarComments } from '../../store/guitars-data/selector';\nimport { useAppSelector } from '../../hooks';\nimport Review from '../review/review';\nimport ReviewModal from '../review-modal/review-modal';\nimport ModalSuccess from '../modal-success/modal-success';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst COMMENTS_COUNT_PER_STEP = 3;\n\nfunction ReviewsList(_ref) {\n  _s();\n\n  let {\n    guitarId,\n    guitarName\n  } = _ref;\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\n  useEffect(() => {\n    store.dispatch(fetchComments(Number(guitarId)));\n  }, [guitarId]);\n  useEffect(() => {\n    document.addEventListener('scroll', scrollHandler);\n    return function () {\n      document.removeEventListener('scroll', scrollHandler);\n    };\n  });\n  const guitarComments = useAppSelector(getGuitarComments);\n  const commentsSorted = guitarComments.slice(0).sort((prev, next) => new Date(next.createAt).getTime() - new Date(prev.createAt).getTime());\n  const commentsForRender = commentsSorted.slice(0, commentsCount);\n\n  function handleShowMoreButtonClick() {\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n  }\n\n  function scrollHandler() {\n    if (document.documentElement.scrollHeight - document.documentElement.scrollTop - window.innerHeight < 250 && commentsCount < guitarComments.length) {\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n    }\n  }\n\n  function onReviewBtnClick() {\n    setIsReviewModalOpened(true);\n  }\n\n  function onReviewCloseClick() {\n    setIsReviewModalOpened(false);\n  }\n\n  function openModalSuccessSubmit() {\n    setIsModalSuccessOpened(true);\n  }\n\n  function closeModalSuccessSubmit() {\n    setIsModalSuccessOpened(false);\n  }\n\n  function onUpButtonClick() {\n    window.scrollTo({\n      top: 0,\n      left: 0,\n      behavior: 'smooth'\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"reviews\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"reviews__title title title--bigger\",\n      children: \"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      className: \"button button--red-border button--big reviews__sumbit-button\",\n      to: \"\",\n      onClick: onReviewBtnClick,\n      children: \"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), commentsForRender.map(comment => /*#__PURE__*/_jsxDEV(Review, {\n      commentForRender: comment\n    }, comment.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }, this)), commentsSorted.length > commentsCount ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"button button--medium reviews__more-button hidden\",\n      onClick: () => handleShowMoreButtonClick(),\n      children: \"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0435\\u0449\\u0435 \\u043E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 11\n    }, this) : '', /*#__PURE__*/_jsxDEV(Link, {\n      className: \"button button--up button--red-border button--big reviews__up-button\",\n      to: \"\",\n      style: commentsSorted.length === 0 ? {\n        bottom: '-61'\n      } : {\n        bottom: '-501'\n      },\n      onClick: onUpButtonClick,\n      children: \"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), isReviewModalOpened && /*#__PURE__*/_jsxDEV(ReviewModal, {\n      idGuitar: guitarId,\n      guitarName: guitarName,\n      onReviewCloseClick: onReviewCloseClick,\n      openModalSuccessSubmit: openModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }, this), isModalSuccessOpened && /*#__PURE__*/_jsxDEV(ModalSuccess, {\n      closeModalSuccessSubmit: closeModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ReviewsList, \"n0g7wD4ugKXiDFKHg3WffePsPvU=\", false, function () {\n  return [useAppSelector];\n});\n\n_c = ReviewsList;\nexport default ReviewsList;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReviewsList\");","map":{"version":3,"names":["useEffect","useState","Link","store","fetchComments","getGuitarComments","useAppSelector","Review","ReviewModal","ModalSuccess","COMMENTS_COUNT_PER_STEP","ReviewsList","guitarId","guitarName","commentsCount","setCommentsCount","isReviewModalOpened","setIsReviewModalOpened","isModalSuccessOpened","setIsModalSuccessOpened","dispatch","Number","document","addEventListener","scrollHandler","removeEventListener","guitarComments","commentsSorted","slice","sort","prev","next","Date","createAt","getTime","commentsForRender","handleShowMoreButtonClick","Math","min","length","documentElement","scrollHeight","scrollTop","window","innerHeight","onReviewBtnClick","onReviewCloseClick","openModalSuccessSubmit","closeModalSuccessSubmit","onUpButtonClick","scrollTo","top","left","behavior","map","comment","id","bottom"],"sources":["C:/Ирина/Projects/guitars-shop/src/components/reviews-list/reviews-list.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { store } from '../../store/index';\r\nimport { fetchComments } from '../../store/api-actions';\r\nimport { getGuitarComments } from '../../store/guitars-data/selector';\r\nimport { useAppSelector } from '../../hooks';\r\n\r\nimport Review from '../review/review';\r\nimport ReviewModal from '../review-modal/review-modal';\r\nimport ModalSuccess from '../modal-success/modal-success';\r\n\r\nconst COMMENTS_COUNT_PER_STEP = 3;\r\n\r\ntype Props = {\r\n  guitarId?: string,\r\n  guitarName:string,\r\n}\r\n\r\nfunction ReviewsList({guitarId, guitarName}: Props): JSX.Element {\r\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\r\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\r\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\r\n\r\n  useEffect(() => {\r\n    store.dispatch(fetchComments(Number(guitarId)));\r\n  }, [guitarId]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('scroll', scrollHandler);\r\n    return function () {\r\n      document.removeEventListener('scroll', scrollHandler);\r\n    };\r\n  });\r\n\r\n  const guitarComments = useAppSelector(getGuitarComments);\r\n\r\n  const commentsSorted =  guitarComments.slice(0).sort((prev, next) =>\r\n    new Date(next.createAt).getTime() - new Date(prev.createAt).getTime(),\r\n  );\r\n\r\n  const commentsForRender = commentsSorted.slice(0, commentsCount);\r\n\r\n  function handleShowMoreButtonClick() {\r\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n  }\r\n\r\n  function scrollHandler() {\r\n    if ((document.documentElement.scrollHeight -\r\n      document.documentElement.scrollTop - window.innerHeight)<250 &&\r\n       commentsCount<guitarComments.length) {\r\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n    }\r\n  }\r\n\r\n  function onReviewBtnClick(){\r\n    setIsReviewModalOpened(true);\r\n  }\r\n\r\n  function onReviewCloseClick(){\r\n    setIsReviewModalOpened(false);\r\n  }\r\n\r\n  function openModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(true);\r\n  }\r\n\r\n  function closeModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(false);\r\n  }\r\n\r\n  function onUpButtonClick() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      left: 0,\r\n      behavior: 'smooth',\r\n    });\r\n  }\r\n\r\n  return (\r\n    <section className=\"reviews\">\r\n      <h3 className=\"reviews__title title title--bigger\">Отзывы</h3>\r\n      <Link className=\"button button--red-border button--big reviews__sumbit-button\"\r\n        to=\"\" onClick={onReviewBtnClick}\r\n      >Оставить отзыв\r\n      </Link>\r\n\r\n      {commentsForRender.map((comment) => (\r\n        <Review commentForRender={comment} key={comment.id}/>\r\n      ))}\r\n\r\n      {\r\n        commentsSorted.length>commentsCount ?\r\n          <button className=\"button button--medium reviews__more-button hidden\"\r\n            onClick={() => handleShowMoreButtonClick()}\r\n          >\r\n        Показать еще отзывы\r\n          </button> :\r\n          ''\r\n      }\r\n\r\n      <Link className=\"button button--up button--red-border button--big reviews__up-button\" to=\"\"\r\n        style={commentsSorted.length===0 ? {bottom:'-61'} : {bottom:'-501'}}\r\n        onClick={onUpButtonClick}\r\n      >\r\n        Наверх\r\n      </Link>\r\n\r\n      {isReviewModalOpened &&\r\n      <ReviewModal idGuitar={guitarId}\r\n        guitarName={guitarName}\r\n        onReviewCloseClick={onReviewCloseClick}\r\n        openModalSuccessSubmit={openModalSuccessSubmit}\r\n      />}\r\n\r\n      {isModalSuccessOpened &&\r\n      <ModalSuccess closeModalSuccessSubmit={closeModalSuccessSubmit}/>}\r\n    </section>\r\n  );\r\n}\r\n\r\nexport default ReviewsList;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}