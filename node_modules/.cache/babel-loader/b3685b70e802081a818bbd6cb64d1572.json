{"ast":null,"code":"var _jsxFileName = \"C:\\\\\\u0418\\u0440\\u0438\\u043D\\u0430\\\\Projects\\\\Guitars-shop\\\\src\\\\components\\\\reviews-list\\\\reviews-list.tsx\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { store } from '../../store/index';\nimport { fetchComments } from '../../store/api-actions';\nimport { useAppSelector } from '../../hooks';\nimport { NameSpace } from '../../consts';\nimport Review from '../review/review';\nimport ReviewModal from '../review-modal/review-modal';\nimport ModalSuccess from '../modal-success/modal-success';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst COMMENTS_COUNT_PER_STEP = 3;\n\nfunction ReviewsList(_ref) {\n  _s();\n\n  let {\n    guitarId,\n    guitarName\n  } = _ref;\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\n  useEffect(() => {\n    store.dispatch(fetchComments(Number(guitarId)));\n  }, [guitarId]);\n  useEffect(() => {\n    document.addEventListener('scroll', scrollHandler);\n    return function () {\n      document.removeEventListener('scroll', scrollHandler);\n    };\n  });\n  const guitarComments = useAppSelector(state => state[NameSpace.Data].guitarsComments); // eslint-disable-next-line no-console\n\n  console.log(guitarComments);\n  const commentsSorted = guitarComments; // const commentsSorted =  guitarComments.slice(0).sort((prev, next) =>\n  //   new Date(next.createAt).getTime() - new Date(prev.createAt).getTime(),\n  // );\n  // const commentsForRender = commentsSorted.slice(0, commentsCount);\n\n  function handleShowMoreButtonClick() {\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n  }\n\n  function scrollHandler() {\n    if (document.documentElement.scrollHeight - document.documentElement.scrollTop - window.innerHeight < 250 && commentsCount < guitarComments.length) {\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\n    }\n  }\n\n  function onReviewBtnClick() {\n    setIsReviewModalOpened(true);\n  }\n\n  function onReviewCloseClick() {\n    setIsReviewModalOpened(false);\n  }\n\n  function openModalSuccessSubmit() {\n    setIsModalSuccessOpened(true);\n  }\n\n  function closeModalSuccessSubmit() {\n    setIsModalSuccessOpened(false);\n  }\n\n  function onUpButtonClick() {\n    window.scrollTo({\n      top: 0,\n      left: 0,\n      behavior: 'smooth'\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"reviews\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"reviews__title title title--bigger\",\n      children: \"\\u041E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Link, {\n      className: \"button button--red-border button--big reviews__sumbit-button\",\n      to: \"\",\n      onClick: onReviewBtnClick,\n      children: \"\\u041E\\u0441\\u0442\\u0430\\u0432\\u0438\\u0442\\u044C \\u043E\\u0442\\u0437\\u044B\\u0432\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }, this), commentsForRender.map(comment => /*#__PURE__*/_jsxDEV(Review, {\n      commentForRender: comment\n    }, comment.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }, this)), commentsSorted.length > commentsCount ? /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"button button--medium reviews__more-button hidden\",\n      onClick: () => handleShowMoreButtonClick(),\n      children: \"\\u041F\\u043E\\u043A\\u0430\\u0437\\u0430\\u0442\\u044C \\u0435\\u0449\\u0435 \\u043E\\u0442\\u0437\\u044B\\u0432\\u044B\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 11\n    }, this) : '', commentsSorted.length === 0 ? /*#__PURE__*/_jsxDEV(Link, {\n      to: \"\",\n      className: \"button button--up button--red-border button--big\",\n      style: {\n        bottom: '-61px',\n        right: '0',\n        position: 'absolute'\n      },\n      onClick: onUpButtonClick,\n      children: \"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }, this) : /*#__PURE__*/_jsxDEV(Link, {\n      to: \"\",\n      className: \"button button--up button--red-border button--big reviews__up-button\",\n      onClick: onUpButtonClick,\n      children: \"\\u041D\\u0430\\u0432\\u0435\\u0440\\u0445\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }, this), isReviewModalOpened && /*#__PURE__*/_jsxDEV(ReviewModal, {\n      idGuitar: guitarId,\n      guitarName: guitarName,\n      onReviewCloseClick: onReviewCloseClick,\n      openModalSuccessSubmit: openModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), isModalSuccessOpened && /*#__PURE__*/_jsxDEV(ModalSuccess, {\n      closeModalSuccessSubmit: closeModalSuccessSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ReviewsList, \"n0g7wD4ugKXiDFKHg3WffePsPvU=\", false, function () {\n  return [useAppSelector];\n});\n\n_c = ReviewsList;\nexport default ReviewsList;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReviewsList\");","map":{"version":3,"names":["useEffect","useState","Link","store","fetchComments","useAppSelector","NameSpace","Review","ReviewModal","ModalSuccess","COMMENTS_COUNT_PER_STEP","ReviewsList","guitarId","guitarName","commentsCount","setCommentsCount","isReviewModalOpened","setIsReviewModalOpened","isModalSuccessOpened","setIsModalSuccessOpened","dispatch","Number","document","addEventListener","scrollHandler","removeEventListener","guitarComments","state","Data","guitarsComments","console","log","commentsSorted","handleShowMoreButtonClick","Math","min","length","documentElement","scrollHeight","scrollTop","window","innerHeight","onReviewBtnClick","onReviewCloseClick","openModalSuccessSubmit","closeModalSuccessSubmit","onUpButtonClick","scrollTo","top","left","behavior","commentsForRender","map","comment","id","bottom","right","position"],"sources":["C:/Ирина/Projects/Guitars-shop/src/components/reviews-list/reviews-list.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nimport { store } from '../../store/index';\r\nimport { fetchComments } from '../../store/api-actions';\r\nimport { useAppSelector } from '../../hooks';\r\nimport { NameSpace } from '../../consts';\r\n\r\nimport Review from '../review/review';\r\nimport ReviewModal from '../review-modal/review-modal';\r\nimport ModalSuccess from '../modal-success/modal-success';\r\n\r\nconst COMMENTS_COUNT_PER_STEP = 3;\r\n\r\ntype Props = {\r\n  guitarId?: string,\r\n  guitarName:string,\r\n}\r\n\r\nfunction ReviewsList({guitarId, guitarName}: Props): JSX.Element {\r\n  const [commentsCount, setCommentsCount] = useState(COMMENTS_COUNT_PER_STEP);\r\n  const [isReviewModalOpened, setIsReviewModalOpened] = useState(false);\r\n  const [isModalSuccessOpened, setIsModalSuccessOpened] = useState(false);\r\n\r\n  useEffect(() => {\r\n    store.dispatch(fetchComments(Number(guitarId)));\r\n  }, [guitarId]);\r\n\r\n  useEffect(() => {\r\n    document.addEventListener('scroll', scrollHandler);\r\n    return function () {\r\n      document.removeEventListener('scroll', scrollHandler);\r\n    };\r\n  });\r\n\r\n  const guitarComments = useAppSelector((state) => state[NameSpace.Data].guitarsComments);\r\n\r\n  // eslint-disable-next-line no-console\r\n  console.log(guitarComments);\r\n  const commentsSorted = guitarComments;\r\n  // const commentsSorted =  guitarComments.slice(0).sort((prev, next) =>\r\n  //   new Date(next.createAt).getTime() - new Date(prev.createAt).getTime(),\r\n  // );\r\n\r\n  // const commentsForRender = commentsSorted.slice(0, commentsCount);\r\n\r\n  function handleShowMoreButtonClick() {\r\n    setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n  }\r\n\r\n  function scrollHandler() {\r\n    if ((document.documentElement.scrollHeight -\r\n      document.documentElement.scrollTop - window.innerHeight)<250 &&\r\n       commentsCount<guitarComments.length) {\r\n      setCommentsCount(Math.min(commentsSorted.length, commentsCount + COMMENTS_COUNT_PER_STEP));\r\n    }\r\n  }\r\n\r\n  function onReviewBtnClick(){\r\n    setIsReviewModalOpened(true);\r\n  }\r\n\r\n  function onReviewCloseClick(){\r\n    setIsReviewModalOpened(false);\r\n  }\r\n\r\n  function openModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(true);\r\n  }\r\n\r\n  function closeModalSuccessSubmit(){\r\n    setIsModalSuccessOpened(false);\r\n  }\r\n\r\n  function onUpButtonClick() {\r\n    window.scrollTo({\r\n      top: 0,\r\n      left: 0,\r\n      behavior: 'smooth',\r\n    });\r\n  }\r\n\r\n  return (\r\n    <section className=\"reviews\">\r\n      <h3 className=\"reviews__title title title--bigger\">Отзывы</h3>\r\n      <Link className=\"button button--red-border button--big reviews__sumbit-button\"\r\n        to=\"\" onClick={onReviewBtnClick}\r\n      >Оставить отзыв\r\n      </Link>\r\n\r\n      {commentsForRender.map((comment) => (\r\n        <Review commentForRender={comment} key={comment.id}/>\r\n      ))}\r\n\r\n      {\r\n        commentsSorted.length>commentsCount ?\r\n          <button className=\"button button--medium reviews__more-button hidden\"\r\n            onClick={() => handleShowMoreButtonClick()}\r\n          >\r\n        Показать еще отзывы\r\n          </button> :\r\n          ''\r\n      }\r\n\r\n      {\r\n        commentsSorted.length === 0 ?\r\n          <Link to=\"\"\r\n            className=\"button button--up button--red-border button--big\"\r\n            style={{bottom:'-61px', right:'0', position:'absolute'}}\r\n            onClick={onUpButtonClick}\r\n          >\r\n        Наверх\r\n          </Link> :\r\n          <Link to=\"\"\r\n            className=\"button button--up button--red-border button--big reviews__up-button\"\r\n            onClick={onUpButtonClick}\r\n          >\r\n      Наверх\r\n          </Link>\r\n      }\r\n\r\n\r\n      {isReviewModalOpened &&\r\n      <ReviewModal idGuitar={guitarId}\r\n        guitarName={guitarName}\r\n        onReviewCloseClick={onReviewCloseClick}\r\n        openModalSuccessSubmit={openModalSuccessSubmit}\r\n      />}\r\n\r\n      {isModalSuccessOpened &&\r\n      <ModalSuccess closeModalSuccessSubmit={closeModalSuccessSubmit}/>}\r\n    </section>\r\n  );\r\n}\r\n\r\nexport default ReviewsList;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}